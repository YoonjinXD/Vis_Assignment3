<!doctype html>
<html lang="en">
  <head>

      <title>Vis_Assignment3_YJ_Chung</title>

      <!-- Required meta tags -->
      <meta charset="utf-8">

      <!-- Semantic UI !-->
      <link rel="stylesheet" type="text/css" href="semantic/semantic.min.css">

      <!-- From D3.js !-->

      <script src="https://d3js.org/d3.v4.min.js"></script>
      <link rel="stylesheet" type="text/css" href="custom.css">

      <style>
          body{
              background-color: #395c79;
          }
          rect {
              stroke: white;
          }
          text {
              font-family: "Helvetica Neue", Helvetica, sans-serif;
              fill: white;
              font-size: 13px;
          }
          div#layout {
              text-align: center;
          }

          div#container {
              width: 1000px;
              height: 600px;
              margin: auto;
          }

          svg {
              width: 100%;
              height: 100%;
          }

          .bar {
              fill: #80cbc4;
              cursor: pointer;
          }
          path {
              stroke: gray;
          }

          line {
              stroke: gray;
          }

          line#limit {
              stroke: #FED966;
              stroke-width: 3;
              stroke-dasharray: 3 6;
          }

          .grid path {
              stroke-width: 0;
          }

          .grid .tick line {
              stroke: #9FAAAE;
              stroke-opacity: 0.3;
          }

          text.divergence {
              font-size: 12px;
              fill: #aa0101;
          }

          text.value {
              font-size: 12px;
          }

          text.label {
              font-size: 14px;
              font-weight: 400;
          }
          text.source {
              font-size: 10px;
          }
      </style>


  </head>
  <body>

      <div class="ui container">

          <!-- No header !-->

          <div class="ui hidden divider"></div>


          <div class="ui container">
              <div class="ui grid">

                  <!-- Title !-->

                  <div class="ui sixteen wide column">
                      <h2 class="ui inverted center aligned icon header">
                          <i class="car icon"></i>
                          <div class="content">
                              Road traffic accidents in Denmark
                              <div class="sub header">From 2001 - 2017</div>
                              <div class="">with type of accident & alcohol-related rate</div>
                          </div>
                      </h2>
                  </div>

                  <!-- Main content !-->

                  <div class="ui sixteen wide column">
                      <div id='layout'>
                          <!-- <h2>Bar chart example</h2> -->
                          <div id='container'>
                              <svg id="bar" />
                          </div>
                      </div>
                  </div>

                  <div class="ui twelve wide column">


                  </div>

              </div>

          </div>
      </div>

      <div class="ui hidden divider"></div>

      <div id="modal_2001" class="ui basic modal"><i class="close icon"></i><div class="ui header">2001</div><div class="content">
              <svg id="tree_2001" width="100%" height="410"><g></g></svg></div></div>
      <div id="modal_2003" class="ui basic modal"><i class="close icon"></i><div class="ui header">2003</div><div class="content">
          <svg id="tree_2003" width="100%" height="410"><g></g></svg></div></div>
      <div id="modal_2005" class="ui basic modal"><i class="close icon"></i><div class="ui header">2005</div><div class="content">
          <svg id="tree_2005" width="100%" height="410"><g></g></svg></div></div>
      <div id="modal_2007" class="ui basic modal"><i class="close icon"></i><div class="ui header">2007</div><div class="content">
          <svg id="tree_2007" width="100%" height="410"><g></g></svg></div></div>
      <div id="modal_2009" class="ui basic modal"><i class="close icon"></i><div class="ui header">2009</div><div class="content">
          <svg id="tree_2009" width="100%" height="410"><g></g></svg></div></div>
      <div id="modal_2011" class="ui basic modal"><i class="close icon"></i><div class="ui header">2011</div><div class="content">
          <svg id="tree_2011" width="100%" height="410"><g></g></svg></div></div>
      <div id="modal_2013" class="ui basic modal"><i class="close icon"></i><div class="ui header">2013</div><div class="content">
          <svg id="tree_2013" width="100%" height="410"><g></g></svg></div></div>
      <div id="modal_2015" class="ui basic modal"><i class="close icon"></i><div class="ui header">2015</div><div class="content">
          <svg id="tree_2015" width="100%" height="410"><g></g></svg></div></div>
      <div id="modal_2017" class="ui basic modal"><i class="close icon"></i><div class="ui header">2017</div><div class="content">
          <svg id="tree_2017" width="100%" height="410"><g></g></svg></div></div>



      </div>



      <!-- Footer !-->
      <div class="ui inverted vertical footer segment">
          <div class="ui container">
              <div class="ui stackable center aligned inverted divided equal height stackable grid">
                  <div class="eight wide column">
                      <h4 class="ui inverted header">Vis Assignment 5</h4>
                      <p class="ui inverted description">Yoon Jin Chung</p>
                  </div>
                  <div class="eight wide column">
                      <div class="ui inverted link list">
                          <span class="item">anazzz1685@gmail.com</span>
                          <span class="item">dpm856@alumni.dk</span>
                          <a href="https://github.com/YoonjinXD" class="item">https://github.com/YoonjinXD</a>
                      </div>
                  </div>
              </div>
          </div>
      </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS, then Semantic !-->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
      <script src="semantic/semantic.min.js"></script>

      <script>
          $(document).ready(function() {
              $.ajax({
                  type: "GET",
                  url: "A5.txt",
                  dataType: "text",
                  success: function(data) {processData(data);}
              });
          });

          function processData(allText) {
              var allTextLines = allText.split('\n');
              var headers = allTextLines[0].split(',');
              var header_length = (headers.length) + 1;
              var data = {};

              for (var i=1; i<allTextLines.length; i++) {
                  var temp = allTextLines[i].split(',');
                  if (temp.length == header_length) {

                      data.push("name : "+ temp[0] + ",");

                      var tarr = [];
                      for (var j=1; j<header_length+1; j++) {
                          tarr.push(headers[j]+":"+ temp[j]);
                      }
                      data.push(tarr);
                  }
                  else{
                  }
              }
              alert(lines[1]);

          }
      </script>


      <script>
          var data = {
              "2001" : {
                  "name" : "2001",
                  "children":[
                      {
                          "name": "One-vehicle",
                          "value": 1507,
                          "rate": 0.4,
                          "color": 'rgb(224, 40, 25, 0.9)',
                      },
                      {
                          "name": "Vehicles on same road",
                          "color": 'rgb(224, 70, 70, 0.68)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 1402,
                                  "rate": 0.26,
                                  "color": 'rgb(224, 65, 54, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 1318,
                                  "rate": 0.09,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Vehicles on different roads",
                          "color": 'rgb(224, 105, 105, 0.9)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 718,
                                  "rate": 0.09,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 774,
                                  "rate": 0.05,
                                  "color": 'rgb(224, 110, 110, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Pedestrians",
                          "value": 790,
                          "rate": 0.17,
                          "color": 'rgb(224, 70, 70, 0.8)',
                      }
                  ]},
              "2003" : {
                  "name" : "2003",
                  "children":[
                      {
                          "name": "One-vehicle",
                          "value": 1521,
                          "rate": 0.42,
                          "color": 'rgb(224, 40, 25, 0.92)',
                      },
                      {
                          "name": "Vehicles on same road",
                          "color": 'rgb(224, 70, 70, 0.68)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 1336,
                                  "rate": 0.28,
                                  "color": 'rgb(224, 65, 54, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 1334,
                                  "rate": 0.11,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Vehicles on different roads",
                          "color": 'rgb(224, 105, 105, 0.9)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 727,
                                  "rate": 0.07,
                                  "color": 'rgb(224, 100, 100, 0.85)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 731,
                                  "rate": 0.06,
                                  "color": 'rgb(224, 110, 110, 0.85)',
                              }
                          ]
                      },
                      {
                          "name": "Pedestrians",
                          "value": 746,
                          "rate": 0.15,
                          "color": 'rgb(224, 80, 80, 0.8)',
                      }
                  ]},
              "2005" : {
                  "name" : "2005",
                  "children":[
                      {
                          "name": "One-vehicle",
                          "value": 1236,
                          "rate": 0.39,
                          "color": 'rgb(224, 40, 25, 0.9)',
                      },
                      {
                          "name": "Vehicles on same road",
                          "color": 'rgb(224, 70, 70, 0.68)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 1027,
                                  "rate": 0.22,
                                  "color": 'rgb(224, 65, 54, 0.8)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 1043,
                                  "rate": 0.09,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Vehicles on different roads",
                          "color": 'rgb(224, 105, 105, 0.9)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 608,
                                  "rate": 0.08,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 583,
                                  "rate": 0.04,
                                  "color": 'rgb(224, 110, 110, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Pedestrians",
                          "value": 613,
                          "rate": 0.17,
                          "color": 'rgb(224, 70, 70, 0.8)',
                      }
                  ]},
              "2007" : {
                  "name" : "2007",
                  "children":[
                      {
                          "name": "One-vehicle",
                          "value": 1214,
                          "rate": 0.42,
                          "color": 'rgb(224, 40, 25, 0.9)',
                      },
                      {
                          "name": "Vehicles on same road",
                          "color": 'rgb(224, 70, 70, 0.68)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 1141,
                                  "rate": 0.28,
                                  "color": 'rgb(224, 65, 54, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 1180,
                                  "rate": 0.09,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Vehicles on different roads",
                          "color": 'rgb(224, 105, 105, 0.9)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 529,
                                  "rate": 0.06,
                                  "color": 'rgb(224, 100, 100, 0.8)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 629,
                                  "rate": 0.05,
                                  "color": 'rgb(224, 110, 110, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Pedestrians",
                          "value": 637,
                          "rate": 0.16,
                          "color": 'rgb(224, 70, 70, 0.8)',
                      }
                  ]},
              "2009" : {
                  "name" : "2009",
                  "children":[
                      {
                          "name": "One-vehicle",
                          "value": 958,
                          "rate": 0.38,
                          "color": 'rgb(224, 40, 25, 0.9)',
                      },
                      {
                          "name": "Vehicles on same road",
                          "color": 'rgb(224, 70, 70, 0.68)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 818,
                                  "rate": 0.25,
                                  "color": 'rgb(224, 65, 54, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 787,
                                  "rate": 0.08,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Vehicles on different roads",
                          "color": 'rgb(224, 105, 105, 0.9)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 395,
                                  "rate": 0.08,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 510,
                                  "rate": 0.05,
                                  "color": 'rgb(224, 110, 110, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Pedestrians",
                          "value": 484,
                          "rate": 0.15,
                          "color": 'rgb(224, 70, 70, 0.8)',
                      }
                  ]},
              "2011" : {
                  "name" : "2011",
                  "children":[
                      {
                          "name": "One-vehicle",
                          "value": 753,
                          "rate": 0.42,
                          "color": 'rgb(224, 40, 25, 0.9)',
                      },
                      {
                          "name": "Vehicles on same road",
                          "color": 'rgb(224, 70, 70, 0.68)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 710,
                                  "rate": 0.19,
                                  "color": 'rgb(224, 65, 54, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 674,
                                  "rate": 0.1,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Vehicles on different roads",
                          "color": 'rgb(224, 105, 105, 0.9)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 384,
                                  "rate": 0.05,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 381,
                                  "rate": 0.04,
                                  "color": 'rgb(224, 110, 110, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Pedestrians",
                          "value": 463,
                          "rate": 0.14,
                          "color": 'rgb(224, 70, 70, 0.8)',
                      }
                  ]},
              "2013" : {
                  "name" : "2013",
                  "children":[
                      {
                          "name": "One-vehicle",
                          "value": 603,
                          "rate": 0.35,
                          "color": 'rgb(224, 40, 25, 0.85)',
                      },
                      {
                          "name": "Vehicles on same road",
                          "color": 'rgb(224, 70, 70, 0.68)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 620,
                                  "rate": 0.2,
                                  "color": 'rgb(224, 65, 54, 0.85)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 554,
                                  "rate": 0.07,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Vehicles on different roads",
                          "color": 'rgb(224, 105, 105, 0.9)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 302,
                                  "rate": 0.06,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 334,
                                  "rate": 0.05,
                                  "color": 'rgb(224, 110, 110, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Pedestrians",
                          "value": 417,
                          "rate": 0.17,
                          "color": 'rgb(224, 70, 70, 0.8)',
                      }
                  ]},
              "2015" : {
                  "name" : "2015",
                  "children":[
                      {
                          "name": "One-vehicle",
                          "value": 494,
                          "rate": 0.34,
                          "color": 'rgb(224, 40, 25, 0.9)',
                      },
                      {
                          "name": "Vehicles on same road",
                          "color": 'rgb(224, 70, 70, 0.68)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 578,
                                  "rate": 0.16,
                                  "color": 'rgb(224, 65, 54, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 557,
                                  "rate": 0.05,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Vehicles on different roads",
                          "color": 'rgb(224, 105, 105, 0.9)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 310,
                                  "rate": 0.04,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 360,
                                  "rate": 0.04,
                                  "color": 'rgb(224, 110, 110, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Pedestrians",
                          "value": 390,
                          "rate": 0.12,
                          "color": 'rgb(224, 70, 70, 0.8)',
                      }
                  ]},
              "2017" : {
                  "name" : "2017",
                  "children":[
                      {
                          "name": "One-vehicle",
                          "value": 514,
                          "rate": 0.29,
                          "color": 'rgb(224, 40, 25, 0.9)',
                      },
                      {
                          "name": "Vehicles on same road",
                          "color": 'rgb(224, 70, 70, 0.68)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 553,
                                  "rate": 0.15,
                                  "color": 'rgb(224, 65, 54, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 572,
                                  "rate": 0.06,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Vehicles on different roads",
                          "color": 'rgb(224, 105, 105, 0.9)',
                          "children":[
                              {
                                  "name": "Without turning",
                                  "value": 279,
                                  "rate": 0.05,
                                  "color": 'rgb(224, 100, 100, 0.9)',
                              },
                              {
                                  "name": "with turning",
                                  "value": 327,
                                  "rate": 0.04,
                                  "color": 'rgb(224, 110, 110, 0.9)',
                              }
                          ]
                      },
                      {
                          "name": "Pedestrians",
                          "value": 404,
                          "rate": 0.13,
                          "color": 'rgb(224, 80, 80, 0.8)',
                      }
                  ]},
          };

          // Bar chart
          // https://insights.stackoverflow.com/survey/2018/#technology-most-loved-dreaded-and-wanted-languages
          const sample = [
              {
                  year: '2001',
                  value: 6861,
                  color: '#000000'
              },
              {
                  year: '2003',
                  value: 6749,
                  color: '#fbcb39'
              },
              {
                  year: '2005',
                  value: 5412,
                  color: '#65cedb'
              },
              {
                  year: '2007',
                  value: 5549,
                  color: '#f9de3f'
              },
              {
                  year: '2009',
                  value: 4174,
                  color: '#008fc9'
              },
              {
                  year: '2011',
                  value: 3525,
                  color: '#008fc9'
              },
              {
                  year: '2013',
                  value: 2984,
                  color: '#008fc9'
              },
              {
                  year: '2015',
                  value: 2853,
                  color: '#008fc9'
              },
              {
                  year: '2017',
                  value: 2789,
                  color: '#008fc9'
              }
          ];

          const svg = d3.select("#bar");
          const svgContainer = d3.select('#container');

          const margin = 80;
          const width = 1000 - 2 * margin;
          const height = 600 - 2 * margin;

          const chart = svg.append('g')
              .attr('transform', `translate(${margin}, ${margin})`);

          const xScale = d3.scaleBand()
              .range([0, width])
              .domain(sample.map((s) => s.year))
              .padding(0.4)

          const yScale = d3.scaleLinear()
              .range([height, 0])
              .domain([0, 7000]);

          // vertical grid lines
          // const makeXLines = () => d3.axisBottom()
          //   .scale(xScale)

          const makeYLines = () => d3.axisLeft()
              .scale(yScale)

          chart.append('g')
              .attr('transform', `translate(0, ${height})`)
              .call(d3.axisBottom(xScale));

          chart.append('g')
              .call(d3.axisLeft(yScale));

          // vertical grid lines
          // chart.append('g')
          //   .attr('class', 'grid')
          //   .attr('transform', `translate(0, ${height})`)
          //   .call(makeXLines()
          //     .tickSize(-height, 0, 0)
          //     .tickFormat('')
          //   )

          chart.append('g')
              .attr('class', 'grid')
              .call(makeYLines()
                  .tickSize(-width, 0, 0)
                  .tickFormat('')
              )

          const barGroups = chart.selectAll()
              .data(sample)
              .enter()
              .append('g')

          barGroups
              .append('rect')
              .attr('class', 'bar')
              .attr('x', (g) => xScale(g.year))
              .attr('y', (g) => yScale(g.value))
              .attr('height', (g) => height - yScale(g.value))
              .attr('width', xScale.bandwidth())
              .on('click', function (now) {
                  d3.selectAll('.value')
                      .attr('opacity', 0)

                  d3.select(this)
                      .transition()
                      .duration(300)
                      .attr('color', '#ff6e52')
                      .attr('x', (a) => xScale(a.year) - 5)
                      .attr('width', xScale.bandwidth() + 10)

                  var modal_id = '#modal_'+ now.year;
                  var tree_id = '#tree_'+ now.year;
                  var data_now = data[now.year];
                  $(modal_id).modal('show');

                  // Treemap
                  var treemapLayout = d3.treemap()
                      .size([800, 400])
                      .paddingOuter(30);

                  var rootNode = d3.hierarchy(data_now)

                  rootNode.sum(function(d) {
                      return d.value;
                  });

                  treemapLayout(rootNode);

                  var nodes = d3.select(tree_id)
                      .selectAll('g')
                      .data(rootNode.descendants())
                      .enter()
                      .append('g')
                      .attr('transform', function(d) {return 'translate(' + [d.x0, d.y0] + ')'})

                  nodes
                      .append('rect')
                      .attr('width', function(d) { return d.x1 - d.x0; })
                      .attr('height', function(d) { return d.y1 - d.y0; })
                      .attr('fill', function(d) { return d.data.color;})

                  nodes
                      .append('text')
                      .attr('dx', 10)
                      .attr('dy', 20)
                      .text(function(d) {return d.data.name;})
                  nodes
                      .append('text')
                      .attr('dx', function(d) { return (d.x1 - d.x0)/2 - 10 ; })
                      .attr('dy', function(d) { return (d.y1 - d.y0)/2;})
                      .text(function(d) {return d.data.rate;})


              })
              .on('mouseenter', function (actual, i) {
                  d3.selectAll('.value')
                      .attr('opacity', 0)

                  d3.select(this)
                      .transition()
                      .duration(300)
                      .attr('opacity', 0.6)
                      .attr('x', (a) => xScale(a.year) - 5)
                      .attr('width', xScale.bandwidth() + 10)

                  const y = yScale(actual.value)

                  line = chart.append('line')
                      .attr('id', 'limit')
                      .attr('x1', 0)
                      .attr('y1', y)
                      .attr('x2', width)
                      .attr('y2', y)

                  barGroups.append('text')
                      .attr('class', 'divergence')
                      .attr('x', (a) => xScale(a.year) + xScale.bandwidth() / 2)
                      .attr('y', (a) => yScale(a.value) + 30)
                      .attr('fill', 'white')
                      .attr('text-anchor', 'middle')
                      .text((a, idx) => {
                          const divergence = (a.value - actual.value)

                          let text = ''
                          if (divergence > 0) text += '+'
                          text += `${divergence}`

                          return idx !== i ? text : '';
                      })


              })
              .on('mouseleave', function () {
                  d3.selectAll('.value')
                      .attr('opacity', 1)

                  d3.select(this)
                      .transition()
                      .duration(300)
                      .attr('opacity', 1)
                      .attr('x', (a) => xScale(a.year))
                      .attr('width', xScale.bandwidth())

                  chart.selectAll('#limit').remove()
                  chart.selectAll('.divergence').remove()
              })

          barGroups
              .append('text')
              .attr('class', 'value')
              .attr('x', (a) => xScale(a.year) + xScale.bandwidth() / 2)
              .attr('y', (a) => yScale(a.value) + 30)
              .attr('text-anchor', 'middle')
              .text((a) => `${a.value}`)

          svg
              .append('text')
              .attr('class', 'label')
              .attr('x', -(height / 2) - margin)
              .attr('y', margin / 3.4)
              .attr('transform', 'rotate(-90)')
              .attr('text-anchor', 'middle')
              .text('Total Accidents')

          svg.append('text')
              .attr('class', 'label')
              .attr('x', width / 2 + margin)
              .attr('y', height + margin * 1.7)
              .attr('text-anchor', 'middle')
              .text('Year')

          svg.append('text')
              .attr('class', 'source')
              .attr('x', width - margin / 2)
              .attr('y', height + margin * 1.7)
              .attr('text-anchor', 'start')
              .text('Source: Stack Overflow, 2018')




      </script>

  </body>
</html>
